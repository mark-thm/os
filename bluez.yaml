# Generated from https://git.alpinelinux.org/aports/plain/main/bluez/APKBUILD
package:
  name: bluez
  version: "5.78"
  epoch: 0
  description: Tools for the Bluetooth protocol stack
  copyright:
    - license: GPL-2.0-or-later AND BSD-2-Clause AND MIT

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle
      - dbus
      - dbus-dev
      - ell-dev
      - eudev-dev
      - glib-dev
      - icu-dev
      - json-c-dev
      - libical-dev
      - libtool
      - linux-headers
      - py3-docutils
      - py3-pygments
      - python3
      - readline-dev

pipeline:
  - uses: fetch
    with:
      expected-sha256: 830fed1915c5d375b8de0f5e6f45fcdea0dcc5ff5ffb3d31db6ed0f00d73c5e3
      uri: https://www.kernel.org/pub/linux/bluetooth/bluez-${{package.version}}.tar.xz

  - uses: autoconf/configure
    with:
      opts: |
        --disable-systemd \
        --enable-library \
        --enable-deprecated \
        --enable-hid2hci \
        --enable-mesh \
        --enable-sixaxis \
        --with-dbusconfdir=/usr/share

  - uses: autoconf/make

  - runs: |
      make DESTDIR="${{targets.destdir}}" install install-pluginLTLIBRARIES
      install -Dm755 test/simple-agent "${{targets.destdir}}"/usr/bin/bluez-simple-agent
      install -Dm755 tools/btmgmt -t "${{targets.destdir}}"/usr/bin/
      install -Dm755 attrib/gatttool -t "${{targets.destdir}}"/usr/bin/

      install -Dm644 obexd/src/org.bluez.obex.service \
        "${{targets.destdir}}"/usr/share/dbus-1/services/org.bluez.obex.service

  - uses: strip

subpackages:
  - name: bluez-dbg
    pipeline:
      - uses: split/debug

  - name: bluez-doc
    pipeline:
      - uses: split/manpages
    description: bluez manpages

  - name: bluez-btmgmt
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin/btmgmt ${{targets.subpkgdir}}/usr/bin

  - name: bluez-btmon
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin/btmon ${{targets.subpkgdir}}/usr/bin

  - name: bluez-cups
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mv ${{targets.destdir}}/usr/lib/cups ${{targets.subpkgdir}}/usr/lib

  - name: bluez-meshctl
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin/meshctl ${{targets.subpkgdir}}/usr/bin

  - name: bluez-dev
    pipeline:
      - uses: split/dev
    description: bluez dev

update:
  enabled: true
  release-monitor:
    identifier: 10029

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        bluemoon --version
        bluetoothctl --version
        btattach --version
        ciptool --version
        gatttool --help
        hciconfig --version
        hcidump --version
        hcitool --version
        hex2hcd --version
        mesh-cfgclient --version
        mesh-cfgtest --version
        mpris-proxy --version
        rfcomm --version
        sdptool --help
